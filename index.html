<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nurillo Teacherman - Braille</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; background: #f4f6f9; }
    .container { max-width: 800px; margin: auto; background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    h1 { text-align: center; color: #2c3e50; }
    .menu { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
    .btn { padding: 16px; font-size: 16px; background: #3498db; color: white; border: none; border-radius: 12px; cursor: pointer; text-align: center; transition: 0.3s; }
    .btn:hover { background: #2980b9; transform: translateY(-2px); }
    .section { display: none; margin-top: 20px; }
    .active { display: block; }
    textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
    .braille-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 200px; margin: 20px auto; }
    .dot { width: 50px; height: 50px; background: #eee; border-radius: 50%; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #666; }
    .dot.active { background: #2c3e50; color: white; }
    .result { margin-top: 15px; padding: 15px; background: #e8f5e9; border-radius: 8px; font-family: monospace; }
    .stats { background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; }
    .refresh-btn { background: #e74c3c; margin-top: 10px; }
    .math-info { background: #f0f8ff; padding: 12px; border-radius: 8px; margin-top: 10px; font-family: monospace; font-size: 14px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Nurillo Teacherman</h1>
    <p style="text-align:center;">Braille o‘qish, yozish va matematik ifoda</p>

    <div class="menu">
      <div class="btn" onclick="show('translate')">Tarjima</div>
      <div class="btn" onclick="show('learn-read')">O‘qish</div>
      <div class="btn" onclick="show('learn-write')">Yozish</div>
      <div class="btn" onclick="show('game-read')">O‘yin: O‘qish</div>
      <div class="btn" onclick="show('game-write')">O‘yin: Yozish</div>
      <div class="btn" onclick="showStats()">Statistikalar</div>
    </div>

    <!-- Tarjima -->
    <div id="translate" class="section active">
      <h3>Matn ↔ Braille</h3>
      <textarea id="text-input" placeholder="SALOM yozing yoki 1-2-3, 1-5"></textarea>
      <button class="btn" onclick="translateText()">Tarjima qilish</button>
      <div id="translate-result" class="result"></div>
    </div>

    <!-- O‘qish o‘rganish -->
    <div id="learn-read" class="section">
      <h3>O‘qishni o‘rganamiz</h3>
      <p id="read-letter"></p>
      <div class="braille-grid" id="read-grid"></div>
      <div id="read-math" class="math-info"></div>
      <button class="btn" onclick="checkRead()">Tekshirish</button>
      <button class="btn refresh-btn" onclick="startLearnRead()">Yangi harf</button>
      <div id="read-result" class="result"></div>
    </div>

    <!-- Yozish o‘rganish -->
    <div id="learn-write" class="section">
      <h3>Yozishni o‘rganamiz</h3>
      <p id="write-letter"></p>
      <div class="braille-grid" id="write-grid"></div>
      <div id="write-math" class="math-info"></div>
      <button class="btn" onclick="checkWrite()">Tekshirish</button>
      <button class="btn refresh-btn" onclick="startLearnWrite()">Yangi harf</button>
      <div id="write-result" class="result"></div>
    </div>

    <!-- O‘yin: O‘qish -->
    <div id="game-read" class="section">
      <h3>O‘yin: O‘qish</h3>
      <p id="game-read-letter"></p>
      <div class="braille-grid" id="game-read-grid"></div>
      <div id="game-read-math" class="math-info"></div>
      <button class="btn" onclick="checkGameRead()">Javob berish</button>
      <button class="btn refresh-btn" onclick="startGameRead()">Yangi harf</button>
      <div id="game-read-result" class="result"></div>
    </div>

    <!-- O‘yin: Yozish -->
    <div id="game-write" class="section">
      <h3>O‘yin: Yozish</h3>
      <p id="game-write-letter"></p>
      <div class="braille-grid" id="game-write-grid"></div>
      <div id="game-write-math" class="math-info"></div>
      <button class="btn" onclick="checkGameWrite()">Javob berish</button>
      <button class="btn refresh-btn" onclick="startGameWrite()">Yangi harf</button>
      <div id="game-write-result" class="result"></div>
    </div>

    <!-- Statistikalar -->
    <div id="stats" class="section">
      <h3>Statistikalar</h3>
      <div class="stats" id="stats-content">Yuklanmoqda...</div>
    </div>
  </div>

  <script>
    // SIZNING JADVALINGIZ
    const kodlar = {
      'A': '1', 'B': '1-2', 'D': '1-4-5', 'E': '1-5',
      'F': '1-2-4', 'G': '1-2-4-5', 'H': '1-4-5-6', 'I': '2-4', 'J': '2-4-5',
      'K': '1-3', 'L': '1-2-3', 'M': '1-3-4', 'N': '1-3-4-5', 'O': '1-3-5',
      'P': '1-2-3-4', 'Q': '1-3-4-5-6', 'R': '1-2-3-5', 'S': '2-3-4', 'T': '2-3-4-5',
      'U': '1-2-6', 'V': '2-4-5-6', 'X': '1-2-5',
      'Y': '1-2-3-4-6', 'Z': '1-3-5-6', "G'": '1-2-4-5-6', "CH": '1-2-3-4-5',
      "SH": '1-5-6', "O'": '1-2-3-6', "NG": '1-3-4-5-1-2-4-5'
    };

    const MIRROR = {1:4, 2:5, 3:6, 4:1, 5:2, 6:3};

    let state = { score: 0, correct: 0, wrong: 0, currentLetter: '', expected: [], selected: [] };

    // MATEMATIK FUNKSIYALAR
    function brailleToDecimal(dots) {
      return dots.split('-').reduce((sum, n) => sum + Math.pow(2, n-1), 0);
    }

    function brailleToBinary(dots) {
      const bits = [0,0,0,0,0,0];
      dots.split('-').forEach(n => { if (n >=1 && n <=6) bits[n-1] = 1; });
      return bits.join('');
    }

    function showMathInfo(letter, dots, elementId) {
      const dec = brailleToDecimal(dots);
      const bin = brailleToBinary(dots);
      const formula = dots.split('-').map(n => `2^${n-1}`).join(' + ');
      document.getElementById(elementId).innerHTML = `
        <b>Matematik ifoda:</b><br>
        ${letter} = ${formula}<br>
        = <b>${dec}</b> (10-lik)<br>
        = <b>${bin}</b> (2-lik)
      `;
    }

    function show(section) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(section).classList.add('active');
      if (section === 'learn-read') startLearnRead();
      if (section === 'learn-write') startLearnWrite();
      if (section === 'game-read') startGameRead();
      if (section === 'game-write') startGameWrite();
    }

    function translateText() {
      const input = document.getElementById('text-input').value.trim().toUpperCase();
      let result = '';
      if (/^[0-9,\-/\s]+$/.test(input)) {
        result = brailleToText(input);
      } else {
        result = textToBraille(input);
      }
      document.getElementById('translate-result').innerHTML = `<b>Natija:</b> ${result}`;
    }

    function textToBraille(text) {
      return text.split('').map(c => kodlar[c] || '?').join(', ');
    }

    function brailleToText(braille) {
      const parts = braille.split(/[\s,]+/).filter(Boolean);
      return parts.map(p => {
        if (p === '/') return ' ';
        const mapped = p.split('-').map(n => MIRROR[parseInt(n)] || parseInt(n)).join('-');
        return Object.entries(kodlar).find(([k,v]) => v === mapped)?.[0] || '?';
      }).join('');
    }

    function createBrailleGrid(id, mode = 'read') {
      const grid = document.getElementById(id);
      grid.innerHTML = '';
      const order = mode === 'write' ? [4,1,5,2,6,3] : [1,4,2,5,3,6];
      order.forEach(num => {
        const dot = document.createElement('div');
        dot.className = 'dot';
        dot.textContent = num;
        dot.dataset.num = num;
        dot.onclick = () => toggleDot(dot);
        grid.appendChild(dot);
      });
    }

    function toggleDot(dot) {
      dot.classList.toggle('active');
      const num = parseInt(dot.dataset.num);
      if (dot.classList.contains('active')) {
        if (!state.selected.includes(num)) state.selected.push(num);
      } else {
        state.selected = state.selected.filter(n => n !== num);
      }
    }

    function randomLetter() {
      const letters = Object.keys(kodlar);
      return letters[Math.floor(Math.random() * letters.length)];
    }

    // O‘qish
    function startLearnRead() {
      const letter = randomLetter();
      state.currentLetter = letter;
      state.expected = kodlar[letter].split('-').map(Number).sort((a,b)=>a-b);
      state.selected = [];
      document.getElementById('read-letter').innerHTML = `Harf: <b>${letter}</b> → Kod: <b>${kodlar[letter]}</b>`;
      showMathInfo(letter, kodlar[letter], 'read-math');
      createBrailleGrid('read-grid', 'read');
      document.getElementById('read-result').innerHTML = '';
    }

    function checkRead() {
      const selected = [...state.selected].sort((a,b)=>a-b);
      const correct = JSON.stringify(selected) === JSON.stringify(state.expected);
      const res = document.getElementById('read-result');
      if (correct) {
        res.innerHTML = 'To‘g‘ri!';
        setTimeout(startLearnRead, 1500);
      } else {
        res.innerHTML = `Xato. To‘g‘ri: ${state.expected.join('-')}`;
      }
    }

    // Yozish
    function startLearnWrite() {
      const letter = randomLetter();
      state.currentLetter = letter;
      const readCode = kodlar[letter].split('-').map(Number);
      const writeCode = readCode.map(n => MIRROR[n]);
      const writeCodeStr = writeCode.sort((a,b)=>a-b).join('-');
      state.expected = writeCode.sort((a,b)=>a-b);
      state.selected = [];
      document.getElementById('write-letter').innerHTML = 
        `Harf: <b>${letter}</b> → Yozing (o‘ngdan): <b>${writeCodeStr}</b>`;
      showMathInfo(letter, writeCodeStr, 'write-math');
      createBrailleGrid('write-grid', 'write');
      document.getElementById('write-result').innerHTML = '';
    }

    function checkWrite() {
      const selected = [...state.selected].sort((a,b)=>a-b);
      const correct = JSON.stringify(selected) === JSON.stringify(state.expected);
      const res = document.getElementById('write-result');
      if (correct) {
        res.innerHTML = 'To‘g‘ri!';
        setTimeout(startLearnWrite, 1500);
      } else {
        res.innerHTML = `Xato. To‘g‘ri: ${state.expected.join('-')}`;
      }
    }

    // O‘yin: O‘qish
    function startGameRead() {
      const letter = randomLetter();
      state.currentLetter = letter;
      state.expected = kodlar[letter].split('-').map(Number).sort((a,b)=>a-b);
      state.selected = [];
      document.getElementById('game-read-letter').innerHTML = `Harf: <b>${letter}</b>`;
      showMathInfo(letter, kodlar[letter], 'game-read-math');
      createBrailleGrid('game-read-grid', 'read');
      document.getElementById('game-read-result').innerHTML = '';
    }

    function checkGameRead() {
      const selected = [...state.selected].sort((a,b)=>a-b);
      const res = document.getElementById('game-read-result');
      if (JSON.stringify(selected) === JSON.stringify(state.expected)) {
        state.score += 10;
        state.correct += 1;
        res.innerHTML = `To‘g‘ri! (+10 ball) Jami: ${state.score}`;
        saveStats();
        setTimeout(startGameRead, 1500);
      } else {
        state.wrong += 1;
        res.innerHTML = `Xato. To‘g‘ri: ${state.expected.join('-')}`;
        saveStats();
      }
    }

    // O‘yin: Yozish
    function startGameWrite() {
      const letter = randomLetter();
      state.currentLetter = letter;
      const readCode = kodlar[letter].split('-').map(Number);
      const writeCode = readCode.map(n => MIRROR[n]);
      state.expected = writeCode.sort((a,b)=>a-b);
      state.selected = [];
      document.getElementById('game-write-letter').innerHTML = `Harf: <b>${letter}</b> → Yozing (o‘ngdan)`;
      showMathInfo(letter, writeCode.sort((a,b)=>a-b).join('-'), 'game-write-math');
      createBrailleGrid('game-write-grid', 'write');
      document.getElementById('game-write-result').innerHTML = '';
    }

    function checkGameWrite() {
      const selected = [...state.selected].sort((a,b)=>a-b);
      const res = document.getElementById('game-write-result');
      if (JSON.stringify(selected) === JSON.stringify(state.expected)) {
        state.score += 10;
        state.correct += 1;
        res.innerHTML = `To‘g‘ri! (+10 ball) Jami: ${state.score}`;
        saveStats();
        setTimeout(startGameWrite, 1500);
      } else {
        state.wrong += 1;
        res.innerHTML = `Xato. To‘g‘ri: ${state.expected.join('-')}`;
        saveStats();
      }
    }

    function saveStats() {
      localStorage.setItem('braille_stats', JSON.stringify(state));
    }

    function showStats() {
      const saved = JSON.parse(localStorage.getItem('braille_stats') || '{}');
      document.getElementById('stats-content').innerHTML = `
        Ballar: <b>${saved.score || 0}</b><br>
        To‘g‘ri javoblar: <b>${saved.correct || 0}</b><br>
        Xato javoblar: <b>${saved.wrong || 0}</b>
      `;
      show('stats');
    }

    show('translate');
  </script>
</body>
</html>
